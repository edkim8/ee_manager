# Spec: F-004 Login Page & Base Structure

## Context
Refactoring the page structure of `layers/base` and implementing the initial Authentication flow.
Based on V1 logic from `supanuxt-yardi` but adapted for global `EE_manager` structure.

## Core Directives
1.  **Structure**: Implement nested URL structure (e.g., `/auth/login`).
2.  **UI Library**: Use Nuxt UI components (`UCard`, `UForm`, etc.).
3.  **Auth**: Use Supabase Auth via `useSupabaseClient`.

## 1. Directory Structure Refactor
Create the following empty files (placeholders) in `layers/base/pages` if they don't exist:

```text
layers/base/pages/
├── index.vue              (Route: /)
├── about.vue              (Route: /about)
├── auth/
│   ├── login.vue          (Route: /auth/login)
│   └── register.vue       (Route: /auth/register)
├── dashboard/
│   └── index.vue          (Route: /dashboard)
├── admin/
│   └── index.vue          (Route: /admin)
├── user/
│   └── profile.vue        (Route: /user/profile)
├── settings/
│   └── index.vue          (Route: /settings)
└── tools/
    └── index.vue          (Route: /tools)
```

## 2. Authentication Logic
### Composable: `layers/base/composables/useAuth.ts`
Create a wrapper for auth logic to keep components clean.
- `signIn(email, password)`: Calls `supabase.auth.signInWithPassword`.
- `signOut()`: Calls `supabase.auth.signOut`.
- `user`: Returns `useSupabaseUser()`.

### Layout: `layers/base/layouts/auth.vue`
- A clean, centered layout for auth pages.
- Background: Gradient (as seen in V1).
- Content: Centered slot.

## 3. Login Page Implementation (`layers/base/pages/auth/login.vue`)
- **Layout**: `auth`
- **Logic**:
    - Use `useAuth()` composable.
    - Validate fields (Email required, Password required).
    - On Success: Redirect to `/dashboard`.
    - On Error: Show error message (Toast or Alert).
- **UI**:
    - Title: "EE Manager"
    - Form: Email, Password.
    - Submit Button: "Sign In" (with loading state).

## 4. Verification Plan (Automated)
Since we want Claude to self-test, create a temporary test script `tests/browser/login_flow.test.ts` (using Puppeteer or Playwright if available, otherwise just manual instructions).
*For this MVP, we will rely on manual verification + console logs.*

## 5. Dispatch Instructions
**Command for Claude**:
(To be generated by Foreman after user approval)

---

## Field Report / Implementation Notes

# Latest Update: F-004 Login Page Complete

**Date**: 2026-01-20
**Session**: Nuxt UI v4 Setup & Login Page Implementation

## Summary

Successfully implemented the Base Layer page structure and Login Page (F-004/F-005). The authentication foundation is now complete and ready for protected routes.

## Completed Work

### 1. Page Structure (`layers/base/pages/`)
```
pages/
├── index.vue              → /
├── about.vue              → /about
├── auth/
│   ├── login.vue          → /auth/login
│   └── register.vue       → /auth/register
├── dashboard/index.vue    → /dashboard
├── admin/index.vue        → /admin
├── user/profile.vue       → /user/profile
├── settings/index.vue     → /settings
└── tools/index.vue        → /tools
```

### 2. Auth Infrastructure
- `layers/base/layouts/auth.vue` - Centered dark gradient layout
- `layers/base/composables/useAuth.ts` - Wraps Supabase auth (`signIn`, `signOut`, `user`)
- `layers/base/components/auth/LoginForm.vue` - Nuxt UI form with Zod validation

### 3. Login Page Features
- Email/Password validation
- Loading state on submit
- Toast notifications on error
- Redirect to `/dashboard` on success

---

## Nuxt UI v4 Standard (CRITICAL)

Through trial and error, we discovered the correct configuration for Nuxt UI v4 in a layered architecture:

### Config Structure

**1. Layer Config** (`layers/base/nuxt.config.ts`):
```ts
export default defineNuxtConfig({
  modules: ['@nuxt/ui'],
  css: ['~/assets/css/main.css']
})
```

**2. CSS File** (`app/assets/css/main.css`):
```css
@import "tailwindcss";
@import "@nuxt/ui";
```
> **IMPORTANT**: CSS must be in `app/assets/` (not `layers/base/assets/`) because the `~` alias resolves to the app directory.

**3. Root App** (`app/app.vue`):
```vue
<template>
  <UApp>
    <NuxtLayout>
      <NuxtPage />
    </NuxtLayout>
  </UApp>
</template>
```
> **IMPORTANT**: `<UApp>` wrapper is required. It handles toasts/notifications automatically (no need for `<UToaster />`).

### Key Learnings
1. **Path Resolution**: `~/` in layer configs resolves to `app/`, not the layer directory
2. **UApp Wrapper**: Required in Nuxt UI v4 - replaces manual `<UNotifications />` / `<UToaster />`
3. **CSS Imports**: Must import both `tailwindcss` and `@nuxt/ui` in that order

---

## Verification

All routes verified working (HTTP 200):
- `/` - Home
- `/auth/login` - Login page with full Nuxt UI styling
- `/dashboard` - Dashboard placeholder
- `/about` - About placeholder

Supabase client initializes without error.
