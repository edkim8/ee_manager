# Excel Table Configuration Template

> **Tool**: Automated column configuration using Excel spreadsheets
> **Purpose**: Define table columns visually with auto-calculated priorities
> **Output**: TypeScript code generated by `utils/table-config-parser.ts`

---

## Template Structure

### Required Sheets

1. **Column Definitions** - Main sheet with all column properties
2. **Table Configuration** - Table-level settings
3. **Filter Groups** - Optional filter/tab definitions
4. **Priority Reference** - Breakpoint thresholds (reference only)
5. **Instructions** - How to use the template

---

## Sheet 1: Column Definitions

### Columns

| Column | Type | Description | Example |
|--------|------|-------------|---------|
| **A: key** | Text | Column key for TypeScript | `unit_name` |
| **B: label** | Text | Display label in table header | `Unit` |
| **C: width** | Number | Column width in pixels | `90` |
| **D: sortable** | Boolean | TRUE/FALSE | `TRUE` |
| **E: align** | Text | left, center, right (or blank) | `center` |
| **F: priority** | **AUTO** | **CALCULATED** - Do not edit manually | `P1` |
| **G: roles** | Text | Comma-separated roles or "all" | `admin,finance` |
| **H: departments** | Text | Comma-separated departments or "all" | `finance` |
| **I: filter_groups** | Text | Comma-separated filter groups or "all" | `available,all` |
| **J: notes** | Text | Your comments/reasoning | `Contact PII` |

### Auto-Calculation Formula for Column F (Priority)

```excel
=IF(SUM($C$2:C2)<=350,"P1",
  IF(SUM($C$2:C2)<=780,"P2",
    IF(SUM($C$2:C2)<=1140,"P3",
      IF(SUM($C$2:C2)<=1880,"P4","P5"))))
```

**How it works:**
- Calculates cumulative width from first column to current row
- Assigns priority based on breakpoint thresholds
- P1: 0-350px (mobile)
- P2: 351-780px (tablet)
- P3: 781-1140px (desktop basic)
- P4: 1141-1880px (desktop wide/QHD)
- P5: 1881px+ (desktop ultra/4K)

### Conditional Formatting (Optional but Recommended)

Apply to Column F:
- **P1** = Light Green fill
- **P2** = Light Blue fill
- **P3** = Light Yellow fill
- **P4** = Light Orange fill
- **P5** = Light Purple fill

### Helper Column K (Optional - for visibility)

**Cumulative Width**:
```excel
=SUM($C$2:C2)
```

This shows the running total of widths for easy debugging.

### Data Validation

**Column D (sortable)**:
- List: `TRUE, FALSE`

**Column E (align)**:
- List: `left, center, right, (blank)`

**Column G (roles)**:
- Suggested list: `all, admin, manager, staff, leasing, maintenance, finance`
- Allow custom entries (comma-separated)

**Column H (departments)**:
- Suggested list: `all, operations, finance, leasing, maintenance`
- Allow custom entries (comma-separated)

---

## Sheet 2: Table Configuration

### Format: Key-Value Pairs

| A: Parameter | B: Value |
|--------------|----------|
| table_name | availabilities |
| file_path | layers/ops/pages/office/availabilities/index.vue |
| has_filter_groups | TRUE |
| default_sort_field | available_date |
| default_sort_direction | asc |
| enable_pagination | TRUE |
| page_size | 25 |
| enable_export | TRUE |
| clickable_rows | TRUE |

### Parameters Explained

| Parameter | Type | Description |
|-----------|------|-------------|
| **table_name** | Text | Short name for the table (used in filename) |
| **file_path** | Text | Target Vue file path |
| **has_filter_groups** | Boolean | TRUE if table has tabs/filters |
| **default_sort_field** | Text | Column key to sort by default |
| **default_sort_direction** | Text | asc or desc |
| **enable_pagination** | Boolean | Enable pagination |
| **page_size** | Number | Rows per page |
| **enable_export** | Boolean | Show CSV/PDF export button |
| **clickable_rows** | Boolean | Enable row click events |

---

## Sheet 3: Filter Groups (Optional)

Only needed if `has_filter_groups = TRUE` in Sheet 2.

### Columns

| A: group_name | B: label | C: description |
|---------------|----------|----------------|
| available | Available Units | Shows vacancy metrics |
| applied | Applications | Shows applicant details |
| leased | Leased Units | Shows lease details |
| all | All Statuses | Mixed view |

### Notes

- **group_name**: Used in code (camelCase or snake_case)
- **label**: Shown in UI tabs/buttons
- **description**: For documentation (optional)

Which columns appear in each group is defined in **Sheet 1, Column I**.

---

## Sheet 4: Priority Reference

**Read-only reference sheet** - shows breakpoint thresholds.

| A: Priority | B: Max Cumulative Width | C: Breakpoint | D: Devices |
|-------------|-------------------------|---------------|------------|
| P1 | 350px | base | Phone (portrait) |
| P2 | 780px | md: (768px+) | Tablet (portrait), Phone (landscape) |
| P3 | 1140px | lg: (1024px+) | Tablet (landscape), Desktop |
| P4 | 1880px | xl: (1280px+) | QHD, 4K (scaled) ⭐ |
| P5 | 2520px | 2xl: (1536px+) | 4K (native), Ultra-wide |

**⭐ P4 (QHD) is the baseline for your desktop users.**

---

## Sheet 5: Instructions

### How to Use This Template

#### 1. Setup
1. Download this template
2. Save a copy with your table name (e.g., `availabilities.xlsx`)
3. Place in `/configs/table-configs/` directory

#### 2. Configure Table (Sheet 2)
1. Go to "Table Configuration" sheet
2. Fill in table metadata (name, file path, etc.)

#### 3. Define Columns (Sheet 1)
1. Go to "Column Definitions" sheet
2. Add one row per column
3. Fill in: key, label, width, sortable, align
4. Priority auto-calculates based on width
5. Set roles/departments/filter_groups
6. Add notes for documentation

**IMPORTANT**: Order matters! Columns are displayed in the order you list them.

#### 4. Define Filter Groups (Sheet 3 - if applicable)
1. If your table has tabs/filters, set `has_filter_groups = TRUE` in Sheet 2
2. Go to "Filter Groups" sheet
3. Add one row per filter/tab
4. In Sheet 1, Column I, specify which groups each column belongs to

#### 5. Review Priority Assignments
1. Check Column F (priority) auto-calculations
2. Verify colors match expectations:
   - Green (P1) = Always visible on mobile
   - Blue (P2) = Tablet+
   - Yellow (P3) = Desktop basic
   - Orange (P4) = QHD baseline
   - Purple (P5) = 4K enhanced

#### 6. Adjust if Needed
- **Too many P1 columns?** Reduce column widths or move less critical columns down
- **Priority jumped unexpectedly?** Check cumulative width (Column K helper)
- **Want to force a column into P4?** Reorder rows (drag to later position)

#### 7. Generate Code
```bash
# Run the parser
npm run generate-table-config configs/table-configs/availabilities.xlsx

# Or manually:
node --loader tsx utils/table-config-parser.ts configs/table-configs/availabilities.xlsx
```

#### 8. Output
- Generated file: `configs/table-configs/availabilities.generated.ts`
- Copy code into your Vue component
- Verify and commit both .xlsx and .generated.ts files

---

## Tips & Best Practices

### Column Width Guidelines

| Type | Width | Examples |
|------|-------|----------|
| **Narrow** | 60-90px | Status, Icon, Checkbox, ID |
| **Medium** | 100-150px | Unit Name, Code, Short Text |
| **Wide** | 150-250px | Names, Emails, Addresses |
| **Actions** | 100-120px | Dropdown, Buttons |

**Average**: ~130px

### Priority Distribution Targets

| Priority | Columns | Cumulative Width | Guidance |
|----------|---------|------------------|----------|
| **P1** | 2-3 | ~250-350px | Bare minimum for identification |
| **P2** | +3-4 | ~650-780px | Essential context |
| **P3** | +2-3 | ~950-1140px | Key operational data |
| **P4** | +4-5 | ~1500-1880px | Full dataset (QHD baseline) |
| **P5** | +4-5 | ~2000-2520px | Maximum detail (4K) |

### Role/Department Rules

**When to restrict:**
- **PII** (emails, phones) → leasing, operations, admin only
- **Financial data** (costs, concessions) → finance, admin only
- **Metadata** (created_at, updated_at) → admin only
- **Assignments** (leasing agent, tech) → relevant departments only

**When NOT to restrict:**
- Core identification (unit, name, status)
- Basic context (building, floor plan)
- Operational dates (move-in, lease end)

### Filter Groups

**Use filter groups when:**
- Table has distinct "modes" or "views" (Available/Applied/Leased)
- Column relevance varies by context
- You want to reduce visual clutter

**Example patterns:**
- Status-based: All/Active/Inactive/Archived
- Type-based: Flooring/Appliances/Cabinets
- Severity-based: Current/Overdue/Closed

---

## Common Issues & Solutions

### Issue: Priority auto-jumped from P2 to P4

**Cause**: Single column width pushed cumulative total past P3 threshold.

**Solution**:
- Check Column K (cumulative width)
- Reduce column widths in P2 range
- Or reorder columns (move expensive column later)

### Issue: Too many columns in P1 (5+ columns)

**Cause**: Column widths too small, or essential columns defined too broadly.

**Solution**:
- Be ruthless - P1 should be 2-3 columns max
- Move "nice to have" columns to P2
- Increase P1 column widths slightly to push some into P2

### Issue: Role restrictions not working

**Cause**: Column still marked as "all" in roles column.

**Solution**:
- Remove "all" from Column G
- List specific roles: `admin,finance,manager`

### Issue: Filter group column not appearing

**Cause**: Column I (filter_groups) doesn't include the group name.

**Solution**:
- Add group name to Column I: `available,all`
- Or use "all" to show in every filter group

---

## Example Walkthrough

See `/configs/table-configs/availabilities.xlsx` for a complete working example.

**Key Features Demonstrated:**
- 16 columns across all 5 priorities
- 4 filter groups (Available, Applied, Leased, All)
- Role restrictions (admin, finance, leasing see extra columns)
- Department restrictions (finance sees concessions, leasing sees agents)
- Auto-calculated priorities based on cumulative width

---

## Workflow Diagram

```
┌─────────────────┐
│ 1. Create Excel │
│    Template     │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 2. Define       │
│    Columns      │
│  (Sheet 1)      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 3. Priorities   │
│  Auto-Calculate │
│  (Formula)      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 4. Review &     │
│    Adjust       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 5. Run Parser   │
│  (Node script)  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 6. Generated    │
│    TypeScript   │
│    Code         │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 7. Copy to Vue  │
│    Component    │
└─────────────────┘
```

---

## File Locations

```
/configs/table-configs/
  ├── availabilities.xlsx          (Excel source)
  ├── availabilities.generated.ts  (Generated code)
  ├── properties.xlsx
  ├── properties.generated.ts
  └── ...

/utils/
  └── table-config-parser.ts       (Parser script)

/docs/tools/
  └── EXCEL_TABLE_CONFIG_TEMPLATE.md (This file)
```

---

## Next Steps

1. **Download template**: Create blank Excel with 5 sheets
2. **Try example**: Use Availabilities as reference
3. **Create your first config**: Start with a simple table (Properties)
4. **Iterate**: Refine based on generated output
5. **Standardize**: Apply to all tables

---

**Questions?** See example: `/configs/table-configs/availabilities.xlsx`
